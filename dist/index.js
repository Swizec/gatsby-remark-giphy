function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e(require("unist-util-visit")),t=e(require("giphy-api"));"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var n=function(e,r,t){try{return Promise.resolve(fetch("https://giphy.com/services/oembed?url="+r.embed_url).then(function(e){if(!e.ok)throw new Error("Request to giphy oembed for "+r.embed_url+" return non-OK");return e.json()})).then(function(n){var i=Math.round(n.height/n.width*Number(t.replace("%","")));return e.type="html",e.children=void 0,e.value='<div style="width:'+t+";height:0;padding-bottom:"+i+'%;position:relative;margin: 0 auto"><iframe src="'+r.embed_url+'" width="100%" height="100%" style="position:absolute" frameborder="0" class="giphy-embed" allowfullscreen></iframe></div>',e})}catch(e){return Promise.reject(e)}};module.exports=function(e,i){var o=e.cache,a=e.markdownAST;try{var u=[],l=t({apiKey:i.giphyApiKey,https:!0}),s=i.embedWidth||"100%";return r(a,"image",function(e){var r=e.url;r.startsWith("giphy:")&&u.push(function(){try{var t=r.replace(/^giphy:/,"");return Promise.resolve(o.get(t)).then(function(r){function a(t){var o=function(){if(i.useIframe)return Promise.resolve(n(e,r[0],s)).then(function(r){e=r});e=i.useVideo?function(e,t,n){var i="<source src="+r[0].images.looping.mp4+' type="video/mp4" />';return e.type="html",e.children=void 0,e.value='<video style="margin: auto auto; display: block; max-width: '+n+'" autoplay loop muted playsinline>\n            '+i+"\n        </video>",e}(e,0,s):function(e,r){var t=e.url.replace(/^giphy:/,"");return e.alt=t,e.url=r.images.downsized_large.url,e.title=e.title||t,e}(e,r[0])}();if(o&&o.then)return o.then(function(){})}var u=function(){if(!r)return function(e,n){try{var i=Promise.resolve(l.search(t)).then(function(e){r=e.data,o.set(t,e.data)})}catch(e){return n(e)}return i&&i.then?i.then(void 0,n):i}(0,function(e){throw e.message="The following error appeared while searching Giphy for "+t+":\n\n"+e.message,e})}();return u&&u.then?u.then(a):a()})}catch(e){return Promise.reject(e)}})}),Promise.resolve(Promise.all(u.map(function(e){return e()}))).then(function(){return a})}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=index.js.map
