import{visit as r}from"unist-util-visit";import e from"giphy-api";function t(r){return"giphy-result:"+r}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));export default function(n,o){var i=n.cache,a=n.markdownAST;try{var u=[],c=e({apiKey:o.giphyApiKey,https:!0});return r(a,"image",function(r){var e=r.url;e.startsWith("giphy:")&&u.push(function(){try{var n=e.replace(/^giphy:/,"").replace(/_/g," ");return Promise.resolve(i.get(t(n))).then(function(e){var o=!1;function a(r){if(o)return r}var u=function(){if(!e){var a=function(r,o){try{var a=Promise.resolve(c.search(n)).then(function(r){e=r.data[0],i.set(t(n),e)})}catch(r){return o(r)}return a&&a.then?a.then(void 0,o):a}(0,function(e){e.message="The following error appeared while transforming Giphy for "+n+":\n\n"+e.message,console.error(e),r.type="text",r.value="",o=!0});if(a&&a.then)return a.then(function(){})}}();return u&&u.then?u.then(a):a(u)})}catch(r){return Promise.reject(r)}})}),Promise.resolve(Promise.all(u.map(function(r){return r()}))).then(function(){return a})}catch(r){return Promise.reject(r)}}
//# sourceMappingURL=index.mjs.map
